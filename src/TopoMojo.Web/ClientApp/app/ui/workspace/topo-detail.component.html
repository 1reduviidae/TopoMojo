<div>
    <div *ngIf="topo">
        <div>
            <h4>{{ topo.name }}</h4>
            <div class="btn-group btn-group-justified">
                <a class="btn btn-default btn-lg" [class.link-active]="showing=='topo'" (click)="show('topo')">
                    <i class="fa fa-sitemap"></i> <span translate>TOPOLOGY</span>
                </a>
                <a class="btn btn-default btn-lg" [class.link-active]="showing=='templates'" (click)="show('templates')">
                    <i class="fa fa-tv"></i> <span translate>MACHINES</span>
                </a>
                <a class="btn btn-default btn-lg" [class.link-active]="showing=='document'" (click)="show('document')">
                    <i class="fa fa-file-text-o"></i> <span translate>DOCUMENT</span>
                </a>
            </div>
        </div>
        <error-div [errors]="errors"></error-div>
        <div [class.hidden]="showing!='topo'" class="col-xs-12 well">
            <div class="col-xs-12 prop">
                <span class="col-xs-2 prop-label" translate>NAME</span>
                <inline-editor class="col-xs-10" type="text" size="30" (onSave)="update()" [(ngModel)]="topo.name"></inline-editor>
            </div>
            <div class="col-xs-12 prop">
                <span class="col-xs-2 prop-label" translate>DESCRIPTION</span>
                <inline-editor class="col-xs-10" type="textarea" rows="3" (onSave)="update()" [(ngModel)]="topo.description"></inline-editor>
            </div>
            <div class="col-xs-12 prop">
                <span class="col-xs-2 prop-label" translate>PUBLISH</span>
                <div class="col-xs-10">
                    <button *ngIf="!topo.isPublished" (click)="publish()" class="btn btn-link" [tooltip]="'ENABLE' | translate | lowercase">
                        <i class="fa fa-toggle-off"></i>
                    </button>
                    <span *ngIf="topo.isPublished">
                        <button (click)="unpublish()" class="btn btn-link" [tooltip]="'DISABLE' | translate | lowercase">
                            <i class="fa fa-toggle-on"></i>
                        </button>
                        <button (click)="clipPublishUrl()" class="btn btn-link" [tooltip]="'COPY' | translate | lowercase">
                                <i class="fa fa-clipboard"></i>
                        </button>
                    </span>
                    <inline-help message="HELP.PUBLISH"></inline-help>
                </div>
            </div>
            <div class="col-xs-12 prop">
                <span class="col-xs-2 prop-label" translate>SHARE</span>
                <div class="col-xs-10">
                    <button *ngIf="!topo.shareCode" (click)="share()" class="btn btn-link" [tooltip]="'ENABLE' | translate | lowercase">
                        <i class="fa fa-toggle-off"></i>
                    </button>
                    <span *ngIf="topo.shareCode">
                        <button (click)="unshare()" class="btn btn-link" [tooltip]="'DISABLE' | translate | lowercase">
                            <i class="fa fa-toggle-on"></i>
                        </button>
                        <button (click)="clipShareUrl()" class="btn btn-link" [tooltip]="'COPY' | translate | lowercase">
                            <i class="fa fa-clipboard"></i>
                        </button>
                        <!--<a href="/enlist/{{topo.shareCode}}">url-to-distribute</a>-->
                    </span>
                    <inline-help message="HELP.SHARE"></inline-help>
                </div>
            </div>
            <div class="col-xs-12 prop">
                <span class="col-xs-2 prop-label" translate>AUTHORS</span>
                <topo-members class="col-xs-10" [workers]="topo.workers"></topo-members>
            </div>
            <div class="col-xs-12" style="text-align:center;">
                <hr/>
                <confirm-delete
                    (onDelete)="delete()"
                    label="DELETE-TOPO"
                    prompt="DELETE-TOPO-PROMPT">
                </confirm-delete>
            </div>
            <textarea id="clipboardText" class="offscreen"></textarea>

        </div>
        <div [class.hidden]="showing!='templates'"  class="col-xs-12 well">
            <div class="">
                <p *ngIf="!topo.templates || topo.templates.length == 0" translate>MACHINE-LIST-EMPTY</p>
                <div *ngIf="topo.templates" >
                    <div *ngFor="let t of topo.templates" class="truncate">
                        <template-editor [topo]="topo" [template]="t" (onRemoved)="remove($event)"></template-editor>
                    </div>
                </div>
            </div>
            <div class="">
                <hr/>
                <div style="text-align:center;">
                    <button (click)="toggleSelector()" class="btn btn-info">
                        <i class="fa fa-plus-circle"></i> <span translate>ADD-MACHINES</span>
                    </button>
                </div>
                <div *ngIf="selectorVisible">
                    <search-bar (onSearch)="search($event)"></search-bar>
                    <entity-list
                        [entities]="publishedTemplates"
                        [icon]="addIcon"
                        (onSelected)="onAdded($event)"></entity-list>
                </div>
            </div>
        </div>
        <div [class.hidden]="showing!='document'"  class="col-xs-12 well">
            <div class="col-xs-12 prop">
                <span class="col-xs-2 prop-label" translate>EXTERNAL-URL</span>
                <div class="col-xs-10">
                    <inline-editor
                        type="text" size="30"
                        (onSave)="update()"
                        [(ngModel)]="topo.documentUrl"
                        default="none"
                        placeholder="External Document Url">
                    </inline-editor>
                    <inline-help message="HELP.EXTERNAL-URL"></inline-help>
                </div>
            </div>
            <div *ngIf="!topo.documentUrl" class="col-xs-12 prop">
                <span class="col-xs-2 prop-label" translate>INTERNAL-DOC</span>
                <span class="col-xs-10">
                    <a [routerLink]="['/doc', topo.id]">Document Editor</a>
                </span>
            </div>
        </div>
        <!-- <div [class.hidden]="showing!='document'" class="">
            <document-editor [id]="topo.globalId"></document-editor>
            <hr />
            <image-manager [id]="topo.globalId"></image-manager>
        </div> -->
    </div>
</div>

<notification-panel></notification-panel>

<!-- <div id="collab-btn">
    <button (click)="collaborate()"
        [tooltip]="'COLLABORATE' | translate | lowercase"
        class="btn btn-default"
        [class.btn-primary]="collaborationVisible || messageCount">
        <i class="fa fa-users"></i>
        <span *ngIf="messageCount" class="badge">{{messageCount}}</span>
    </button>
</div>

<div [hidden]="!collaborationVisible" id="collab-div">
    <chat-messages *ngIf="topo && collaborationVisible" [space]="topo"></chat-messages>
</div> -->

<div *ngIf="showOverlay" class="overlay">
    <div class="row col-xs-4 col-xs-offset-4 well vcenter">
        <h2 translate>EVENT.TOPO.OVER</h2>
        <button class="btn btn-default btn-lg" (click)="redirect()" translate>CONTINUE</button>
    </div>
</div>